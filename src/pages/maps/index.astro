---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const maps = (await getCollection('maps')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title="Maps | Sambit">
  <header class="page-header">
    <h1>Maps</h1>
    <p class="lead">Cross-domain connections, pattern synthesis, and conceptual mappings</p>
  </header>

  <div class="maps-gallery">
    {maps.map((map) => {
      const primaryType = map.data.visualType?.[0] || 'diagram';
      return (
        <article class="gallery-item">
          <a href={`/maps/${map.id}`} class="gallery-link">
            <div class={`visual-preview ${primaryType}`}>
              <div class="preview-pattern"></div>
              <div class="type-label">
                {map.data.visualType?.map((type) => (
                  <span class="type-badge">{type}</span>
                ))}
              </div>
            </div>

            <div class="gallery-content">
              <div class="domains-row">
                {map.data.domains.map((domain) => (
                  <span class="domain-badge">{domain}</span>
                ))}
              </div>

              <h2>{map.data.title}</h2>
              <p class="description">{map.data.description}</p>

              {map.data.patterns && map.data.patterns.length > 0 && (
                <div class="patterns-footer">
                  {map.data.patterns.slice(0, 3).map((pattern) => (
                    <span class="pattern-tag">{pattern}</span>
                  ))}
                  {map.data.patterns.length > 3 && (
                    <span class="pattern-more">+{map.data.patterns.length - 3} more</span>
                  )}
                </div>
              )}
            </div>
          </a>
        </article>
      );
    })}
  </div>

  {maps.length === 0 && (
    <div class="empty-state">
      <p>No maps yet. Check back soon.</p>
    </div>
  )}
</BaseLayout>

<style>
  .page-header {
    margin-bottom: 3rem;
  }

  .lead {
    font-size: 1.125rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
  }

  .maps-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
    gap: 2rem;
  }

  .gallery-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .gallery-item:hover {
    border-color: var(--accent);
    box-shadow: var(--shadow-lg);
    transform: translateY(-6px);
  }

  .gallery-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  /* Visual Preview Area */
  .visual-preview {
    position: relative;
    height: 200px;
    overflow: hidden;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  }

  [data-theme="dark"] .visual-preview {
    background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
  }

  .visual-preview.diagram {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  }

  [data-theme="dark"] .visual-preview.diagram {
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
  }

  .visual-preview.animation {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  }

  [data-theme="dark"] .visual-preview.animation {
    background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
  }

  .visual-preview.data-viz {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
  }

  [data-theme="dark"] .visual-preview.data-viz {
    background: linear-gradient(135deg, #14532d 0%, #166534 100%);
  }

  .visual-preview.interactive {
    background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%);
  }

  [data-theme="dark"] .visual-preview.interactive {
    background: linear-gradient(135deg, #581c87 0%, #6b21a8 100%);
  }

  /* Preview Patterns - Abstract Visual Representations */
  .preview-pattern {
    position: absolute;
    inset: 0;
    opacity: 0.15;
  }

  .diagram .preview-pattern {
    background-image:
      linear-gradient(0deg, transparent 24%, rgba(59, 130, 246, 0.3) 25%, rgba(59, 130, 246, 0.3) 26%, transparent 27%, transparent 74%, rgba(59, 130, 246, 0.3) 75%, rgba(59, 130, 246, 0.3) 76%, transparent 77%, transparent),
      linear-gradient(90deg, transparent 24%, rgba(59, 130, 246, 0.3) 25%, rgba(59, 130, 246, 0.3) 26%, transparent 27%, transparent 74%, rgba(59, 130, 246, 0.3) 75%, rgba(59, 130, 246, 0.3) 76%, transparent 77%, transparent);
    background-size: 50px 50px;
  }

  .animation .preview-pattern {
    background: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 20px,
      rgba(251, 191, 36, 0.3) 20px,
      rgba(251, 191, 36, 0.3) 22px
    );
  }

  .data-viz .preview-pattern {
    background-image: linear-gradient(90deg, transparent 79px, rgba(34, 197, 94, 0.3) 79px, rgba(34, 197, 94, 0.3) 81px, transparent 81px),
      linear-gradient(rgba(34, 197, 94, 0.2) 0.5px, transparent 0.5px);
    background-size: 80px 20px;
  }

  .interactive .preview-pattern {
    background-image: radial-gradient(circle, rgba(168, 85, 247, 0.3) 1px, transparent 1px);
    background-size: 30px 30px;
  }

  .type-label {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
  }

  .type-badge {
    font-size: 0.6875rem;
    padding: 0.25rem 0.625rem;
    background: rgba(255, 255, 255, 0.9);
    color: var(--text-primary);
    border-radius: 0.25rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    backdrop-filter: blur(8px);
  }

  [data-theme="dark"] .type-badge {
    background: rgba(0, 0, 0, 0.6);
  }

  /* Gallery Content */
  .gallery-content {
    padding: 1.5rem;
  }

  .domains-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .domain-badge {
    font-size: 0.6875rem;
    padding: 0.25rem 0.625rem;
    background: var(--accent);
    color: white;
    border-radius: 0.25rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .gallery-item h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 0.625rem 0;
    line-height: 1.3;
    color: var(--text-primary);
    font-family: var(--font-serif);
  }

  .description {
    color: var(--text-secondary);
    font-size: 0.9375rem;
    line-height: 1.6;
    margin: 0 0 1rem 0;
  }

  .patterns-footer {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border);
  }

  .pattern-tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text-secondary);
    border-radius: 0.25rem;
    font-style: italic;
  }

  .pattern-more {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    padding: 0.25rem 0.5rem;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-secondary);
  }

  @media (max-width: 768px) {
    .maps-gallery {
      grid-template-columns: 1fr;
    }

    .visual-preview {
      height: 180px;
    }
  }
</style>
