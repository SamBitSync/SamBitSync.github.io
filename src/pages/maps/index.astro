---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const maps = (await getCollection('maps')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title="Maps | Sambit">
  <header class="page-header">
    <h1>Maps</h1>
    <p class="lead">Cross-domain connections, pattern synthesis, conceptual mappings, and maps of content</p>
  </header>

  <div class="maps-gallery" data-gallery>
    {maps.map((map) => {
      const primaryType = map.data.visualType?.[0] || 'diagram';
      const mapType = map.data.mapType;
      return (
        <article class="gallery-item" data-map-type={mapType} data-domains={map.data.domains.join(',')}>
          <a href={`/maps/${map.id}`} class="gallery-link">
            <div class={`visual-preview ${primaryType}`}>
              <div class="preview-pattern"></div>
              <div class="maptype-label">
                <button
                  class="maptype-badge"
                  data-maptype={mapType}
                  type="button"
                  aria-label={`Filter by ${mapType}`}>
                  {mapType}
                </button>
              </div>
            </div>

            <div class="gallery-content">
              <div class="domains-row">
                {map.data.domains.map((domain) => (
                  <button
                    class="domain-badge"
                    data-domain={domain.toLowerCase().replace(/\s+/g, '-')}
                    type="button"
                    aria-label={`Filter by ${domain}`}>
                    {domain}
                  </button>
                ))}
              </div>

              <h2>{map.data.title}</h2>
              <p class="description">{map.data.description}</p>

              {map.data.patterns && map.data.patterns.length > 0 && (
                <div class="patterns-footer">
                  {map.data.patterns.slice(0, 3).map((pattern) => (
                    <span class="pattern-tag">{pattern}</span>
                  ))}
                  {map.data.patterns.length > 3 && (
                    <span class="pattern-more">+{map.data.patterns.length - 3} more</span>
                  )}
                  {map.data.visualType && map.data.visualType.length > 0 && (
                    <span class="visual-type-label">
                      {map.data.visualType.join(', ')}
                    </span>
                  )}
                </div>
              )}
            </div>
          </a>
        </article>
      );
    })}
  </div>

  {maps.length === 0 && (
    <div class="empty-state">
      <p>No maps yet. Check back soon.</p>
    </div>
  )}
</BaseLayout>

<script>
  // Client-side filtering for maps
  let activeFilters = {
    mapType: null,
    domain: null
  };

  function applyFilters() {
    const items = document.querySelectorAll('.gallery-item');

    items.forEach(item => {
      const mapType = item.getAttribute('data-map-type');
      const domains = item.getAttribute('data-domains')?.split(',') || [];

      let show = true;

      if (activeFilters.mapType && mapType !== activeFilters.mapType) {
        show = false;
      }

      if (activeFilters.domain && !domains.includes(activeFilters.domain)) {
        show = false;
      }

      if (show) {
        item.style.display = '';
        item.style.opacity = '1';
      } else {
        item.style.display = 'none';
        item.style.opacity = '0';
      }
    });

    // Update active states on badges
    updateBadgeStates();
  }

  function updateBadgeStates() {
    // Reset all badges
    document.querySelectorAll('.maptype-badge, .domain-badge').forEach(badge => {
      badge.classList.remove('active');
    });

    // Mark active badges
    if (activeFilters.mapType) {
      document.querySelectorAll(`[data-maptype="${activeFilters.mapType}"]`).forEach(badge => {
        badge.classList.add('active');
      });
    }

    if (activeFilters.domain) {
      document.querySelectorAll(`[data-domain="${activeFilters.domain}"]`).forEach(badge => {
        badge.classList.add('active');
      });
    }
  }

  // Map type filter handlers
  document.querySelectorAll('.maptype-badge').forEach(badge => {
    badge.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();

      const mapType = badge.getAttribute('data-maptype');

      // Toggle filter
      if (activeFilters.mapType === mapType) {
        activeFilters.mapType = null;
      } else {
        activeFilters.mapType = mapType;
      }

      applyFilters();
    });
  });

  // Domain filter handlers
  document.querySelectorAll('.domain-badge').forEach(badge => {
    badge.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();

      const domain = badge.getAttribute('data-domain');

      // Toggle filter
      if (activeFilters.domain === domain) {
        activeFilters.domain = null;
      } else {
        activeFilters.domain = domain;
      }

      applyFilters();
    });
  });
</script>

<style>
  .page-header {
    margin-bottom: 3rem;
  }

  .lead {
    font-size: 1.125rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
  }

  .maps-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
    gap: 2rem;
  }

  .gallery-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.4s ease,
                transform 0.3s ease;
  }

  .gallery-item:hover {
    border-color: var(--accent);
    box-shadow: var(--shadow-lg);
    transform: translateY(-6px);
  }

  .gallery-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  /* Visual Preview Area */
  .visual-preview {
    position: relative;
    height: 200px;
    overflow: hidden;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  }

  [data-theme="dark"] .visual-preview {
    background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
  }

  .visual-preview.diagram {
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  }

  [data-theme="dark"] .visual-preview.diagram {
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
  }

  .visual-preview.animation {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  }

  [data-theme="dark"] .visual-preview.animation {
    background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
  }

  .visual-preview.data-viz {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
  }

  [data-theme="dark"] .visual-preview.data-viz {
    background: linear-gradient(135deg, #14532d 0%, #166534 100%);
  }

  .visual-preview.interactive {
    background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%);
  }

  [data-theme="dark"] .visual-preview.interactive {
    background: linear-gradient(135deg, #581c87 0%, #6b21a8 100%);
  }

  /* Preview Patterns - Abstract Visual Representations */
  .preview-pattern {
    position: absolute;
    inset: 0;
    opacity: 0.15;
  }

  .diagram .preview-pattern {
    background-image:
      linear-gradient(0deg, transparent 24%, rgba(59, 130, 246, 0.3) 25%, rgba(59, 130, 246, 0.3) 26%, transparent 27%, transparent 74%, rgba(59, 130, 246, 0.3) 75%, rgba(59, 130, 246, 0.3) 76%, transparent 77%, transparent),
      linear-gradient(90deg, transparent 24%, rgba(59, 130, 246, 0.3) 25%, rgba(59, 130, 246, 0.3) 26%, transparent 27%, transparent 74%, rgba(59, 130, 246, 0.3) 75%, rgba(59, 130, 246, 0.3) 76%, transparent 77%, transparent);
    background-size: 50px 50px;
  }

  .animation .preview-pattern {
    background: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 20px,
      rgba(251, 191, 36, 0.3) 20px,
      rgba(251, 191, 36, 0.3) 22px
    );
  }

  .data-viz .preview-pattern {
    background-image: linear-gradient(90deg, transparent 79px, rgba(34, 197, 94, 0.3) 79px, rgba(34, 197, 94, 0.3) 81px, transparent 81px),
      linear-gradient(rgba(34, 197, 94, 0.2) 0.5px, transparent 0.5px);
    background-size: 80px 20px;
  }

  .interactive .preview-pattern {
    background-image: radial-gradient(circle, rgba(168, 85, 247, 0.3) 1px, transparent 1px);
    background-size: 30px 30px;
  }

  .maptype-label {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
  }

  .maptype-badge {
    font-size: 0.6875rem;
    padding: 0.25rem 0.625rem;
    background: rgba(0, 0, 0, 0.75);
    color: white;
    border-radius: 0.25rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.075em;
    border: 1.5px solid rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(8px);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .maptype-badge:hover {
    background: rgba(0, 0, 0, 0.85);
    border-color: rgba(255, 255, 255, 0.4);
    transform: scale(1.05);
  }

  .maptype-badge.active {
    background: rgba(59, 130, 246, 0.9);
    border-color: rgb(59, 130, 246);
  }

  [data-theme="dark"] .maptype-badge {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    border: 1.5px solid rgba(255, 255, 255, 0.35);
    backdrop-filter: blur(8px);
  }

  [data-theme="dark"] .maptype-badge:hover {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.5);
  }

  [data-theme="dark"] .maptype-badge.active {
    background: rgba(96, 165, 250, 0.3);
    border-color: rgb(96, 165, 250);
  }

  /* Gallery Content */
  .gallery-content {
    padding: 1.5rem;
  }

  .domains-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  /* Swiss Design: High Contrast Minimal with Semantic Color */
  .domain-badge {
    font-size: 0.6875rem;
    padding: 0.25rem 0.75rem;
    background: rgba(0, 0, 0, 0.05);
    color: var(--text-primary);
    border: 1.5px solid rgba(0, 0, 0, 0.15);
    border-radius: 0.25rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.075em;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Cognitive/Mind - Blue */
  .domain-badge[data-domain*="cognitive"],
  .domain-badge[data-domain*="mind"] {
    background: rgba(59, 130, 246, 0.08);
    border-color: rgba(59, 130, 246, 0.25);
    color: #1e40af;
  }

  /* Complexity/Systems - Purple */
  .domain-badge[data-domain*="complexity"],
  .domain-badge[data-domain*="systems"] {
    background: rgba(139, 92, 246, 0.08);
    border-color: rgba(139, 92, 246, 0.25);
    color: #6b21a8;
  }

  /* Epistemology/Philosophy - Rose */
  .domain-badge[data-domain*="epistemology"],
  .domain-badge[data-domain*="philosophy"] {
    background: rgba(236, 72, 153, 0.08);
    border-color: rgba(236, 72, 153, 0.25);
    color: #9f1239;
  }

  /* Architecture/Design - Green */
  .domain-badge[data-domain*="architecture"],
  .domain-badge[data-domain*="design"] {
    background: rgba(34, 197, 94, 0.08);
    border-color: rgba(34, 197, 94, 0.25);
    color: #15803d;
  }

  /* Method/Methodology - Amber */
  .domain-badge[data-domain*="method"] {
    background: rgba(245, 158, 11, 0.08);
    border-color: rgba(245, 158, 11, 0.25);
    color: #92400e;
  }

  .domain-badge:hover {
    filter: brightness(0.95);
    transform: translateY(-1px);
  }

  .domain-badge.active {
    border-width: 2px;
    font-weight: 600;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.05);
  }

  [data-theme="dark"] .domain-badge {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--text-secondary);
  }

  /* Dark mode semantic colors - desaturated */
  [data-theme="dark"] .domain-badge[data-domain*="cognitive"],
  [data-theme="dark"] .domain-badge[data-domain*="mind"] {
    background: rgba(59, 130, 246, 0.1);
    border-color: rgba(59, 130, 246, 0.25);
    color: #93c5fd;
  }

  [data-theme="dark"] .domain-badge[data-domain*="complexity"],
  [data-theme="dark"] .domain-badge[data-domain*="systems"] {
    background: rgba(139, 92, 246, 0.1);
    border-color: rgba(139, 92, 246, 0.25);
    color: #c4b5fd;
  }

  [data-theme="dark"] .domain-badge[data-domain*="epistemology"],
  [data-theme="dark"] .domain-badge[data-domain*="philosophy"] {
    background: rgba(236, 72, 153, 0.1);
    border-color: rgba(236, 72, 153, 0.25);
    color: #f9a8d4;
  }

  [data-theme="dark"] .domain-badge[data-domain*="architecture"],
  [data-theme="dark"] .domain-badge[data-domain*="design"] {
    background: rgba(34, 197, 94, 0.1);
    border-color: rgba(34, 197, 94, 0.25);
    color: #86efac;
  }

  [data-theme="dark"] .domain-badge[data-domain*="method"] {
    background: rgba(245, 158, 11, 0.1);
    border-color: rgba(245, 158, 11, 0.25);
    color: #fcd34d;
  }

  [data-theme="dark"] .domain-badge:hover {
    filter: brightness(1.1);
    transform: translateY(-1px);
  }

  [data-theme="dark"] .domain-badge.active {
    border-width: 2px;
    font-weight: 600;
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
  }

  .gallery-item h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 0.625rem 0;
    line-height: 1.3;
    color: var(--text-primary);
    font-family: var(--font-serif);
  }

  .description {
    color: var(--text-secondary);
    font-size: 0.9375rem;
    line-height: 1.6;
    margin: 0 0 1rem 0;
  }

  .patterns-footer {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border);
  }

  .pattern-tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.625rem;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-secondary);
    border-radius: 0.25rem;
    font-style: italic;
    font-weight: 400;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .pattern-tag:hover {
    background: var(--surface);
    border-color: var(--text-tertiary);
  }

  [data-theme="dark"] .pattern-tag {
    border-color: rgba(255, 255, 255, 0.15);
    color: var(--text-secondary);
  }

  [data-theme="dark"] .pattern-tag:hover {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.25);
  }

  .pattern-more {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    padding: 0.25rem 0.5rem;
  }

  .visual-type-label {
    font-size: 0.6875rem;
    padding: 0.25rem 0.625rem;
    background: transparent;
    border: 1px dashed var(--border);
    color: var(--text-tertiary);
    border-radius: 0.25rem;
    font-weight: 400;
    font-style: italic;
    text-transform: lowercase;
  }

  [data-theme="dark"] .visual-type-label {
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--text-tertiary);
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-secondary);
  }

  @media (max-width: 768px) {
    .maps-gallery {
      grid-template-columns: 1fr;
    }

    .visual-preview {
      height: 180px;
    }
  }
</style>
